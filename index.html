<!DOCTYPE html>
<html>
<head>
  <title>MCQ Test System</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .hidden { display: none; }
    button { padding: 8px 12px; margin: 5px; }
    input { padding: 6px; width: 300px; margin: 5px 0; }
    textarea { width: 100%; height: 80px; }
    .box { border: 1px solid #ccc; padding: 15px; margin-top: 15px; }
  </style>
</head>
<body>

<h2>Login As</h2>
<button onclick="showStudent()">Student</button>
<button onclick="showTeacher()">Teacher</button>

<!-- STUDENT PANEL -->
<div id="studentPanel" class="box hidden">
  <h3>Student Panel</h3>
  <input id="studentName" placeholder="Enter your name"><br>
  <button onclick="loadTests()">Load Tests</button>
  <div id="testList"></div>
  <div id="examArea"></div>
</div>

<!-- TEACHER LOGIN -->
<div id="teacherLogin" class="box hidden">
  <h3>Teacher Login</h3>
  <input id="teacherPin" type="password" placeholder="Enter PIN">
  <button onclick="loginTeacher()">Login</button>
</div>

<!-- TEACHER PANEL -->
<div id="teacherPanel" class="box hidden">
  <h3>Teacher Panel</h3>

  <input id="testName" placeholder="Test Name"><br>
  <input id="testTime" type="number" placeholder="Time (minutes)"><br>

  <h4>Questions (FORMAT)</h4>
  <textarea id="questionsBox" placeholder="Question |&#10;Option1 |&#10;Option2 |&#10;Option3 |&#10;Option4 |&#10;CorrectIndex (0-based)"></textarea>

  <button onclick="createTest()">Create Test</button>
  <hr>
  <h4>Student Attempts</h4>
  <div id="attempts"></div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBQ2-dTUTPwhf7WqceEwXpk9CtPksR1xCk",
  authDomain: "hera-mcqs-55022.firebaseapp.com",
  databaseURL: "https://hera-mcqs-55022-default-rtdb.firebaseio.com",
  projectId: "hera-mcqs-55022",
  storageBucket: "hera-mcqs-55022.firebasestorage.app",
  messagingSenderId: "878791404574",
  appId: "1:878791404574:web:a0ec3ab2819423aa09120f"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function showStudent(){
  hideAll();
  studentPanel.classList.remove("hidden");
}
function showTeacher(){
  hideAll();
  teacherLogin.classList.remove("hidden");
}
function hideAll(){
  studentPanel.classList.add("hidden");
  teacherLogin.classList.add("hidden");
  teacherPanel.classList.add("hidden");
}

function loginTeacher(){
  if(teacherPin.value === "12345"){
    teacherLogin.classList.add("hidden");
    teacherPanel.classList.remove("hidden");
    loadAttempts();
  } else alert("Wrong PIN");
}

function createTest(){
  const name = testName.value;
  const time = Number(testTime.value);
  if(!name || !time) return alert("Fill all");

  const lines = questionsBox.value.split("\n");
  let questions = [];
  for(let i=0;i<lines.length;i+=6){
    questions.push({
      q: lines[i],
      options: [lines[i+1],lines[i+2],lines[i+3],lines[i+4]],
      correct: Number(lines[i+5])
    });
  }

  db.ref("tests/"+Date.now()).set({name,time,questions});
  alert("Test Created");
}

function loadTests(){
  testList.innerHTML="";
  db.ref("tests").once("value",snap=>{
    snap.forEach(s=>{
      const btn=document.createElement("button");
      btn.textContent=s.val().name;
      btn.onclick=()=>startTest(s.key,s.val());
      testList.appendChild(btn);
    });
  });
}

let timerInt, remaining;

function startTest(id,test){
  examArea.innerHTML="";
  remaining = test.time*60;

  const timer=document.createElement("h4");
  examArea.appendChild(timer);

  timerInt=setInterval(()=>{
    timer.textContent="Time: "+remaining+"s";
    if(remaining--<=0){
      clearInterval(timerInt);
      submitTest(id,test);
    }
  },1000);

  test.questions.forEach((q,i)=>{
    examArea.innerHTML+=`<p>${i+1}. ${q.q}</p>`;
    q.options.forEach((o,j)=>{
      examArea.innerHTML+=
      `<label><input type="radio" name="q${i}" value="${j}"> ${o}</label><br>`;
    });
  });

  const btn=document.createElement("button");
  btn.textContent="Submit";
  btn.onclick=()=>submitTest(id,test);
  examArea.appendChild(btn);
}

function submitTest(id,test){
  clearInterval(timerInt);
  let score=0;
  test.questions.forEach((q,i)=>{
    const sel=document.querySelector(`input[name=q${i}]:checked`);
    if(sel && Number(sel.value)===q.correct) score++;
  });
  db.ref("attempts/"+id+"/"+studentName.value).set({score});
  alert("Submitted");
}

function loadAttempts(){
  db.ref("attempts").on("value",snap=>{
    attempts.innerHTML="";
    snap.forEach(t=>{
      t.forEach(s=>{
        attempts.innerHTML+=`<p>${s.key}: ${s.val().score}</p>`;
      });
    });
  });
}
</script>

</body>
</html>
