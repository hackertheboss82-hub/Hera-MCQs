<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>School MCQ Test System</title>
<style>
body { font-family: Arial; background:#f4f6f8; padding:20px }
h2 { margin-top:0 }
.box { background:#fff; padding:20px; border-radius:8px; margin-bottom:20px }
input, select, textarea, button {
  width:100%; padding:10px; margin:6px 0; font-size:15px
}
button { background:#2563eb; color:#fff; border:none; cursor:pointer }
button:hover { opacity:0.9 }
.hidden { display:none }
.testBox { border:1px solid #ddd; padding:10px; margin:10px 0 }
.option { margin:5px 0 }
.timer { font-weight:bold; color:red }
</style>
</head>
<body>

<h2>MCQ Online Test</h2>
<button onclick="showStudent()">Student</button>
<button onclick="showTeacher()">Teacher</button>

<!-- TEACHER LOGIN -->
<div id="teacherLogin" class="box hidden">
  <h3>Teacher Login</h3>
  <input type="password" id="teacherPin" placeholder="Enter PIN">
  <button onclick="loginTeacher()">Login</button>
</div>

<!-- TEACHER PANEL -->
<div id="teacherPanel" class="box hidden">
  <h3>Teacher Panel</h3>

  <input id="testName" placeholder="Test Name">
  <select id="testClass">
    <option value="">Select Class</option>
    <option>Jr KG</option><option>Sr KG</option>
    <option>1</option><option>2</option><option>3</option>
    <option>4</option><option>5</option><option>6</option>
    <option>7</option><option>8</option><option>9</option><option>10</option>
  </select>
  <input id="testTime" placeholder="Time (minutes)" type="number">

  <textarea id="questions" rows="8"
placeholder="FORMAT:
Question
Option1
Option2
Option3
Option4
CorrectIndex (0-based)
(repeat)"></textarea>

  <button onclick="createTest()">Create Test</button>

  <h4>Existing Tests</h4>
  <div id="testList"></div>

  <h4>Student Attempts</h4>
  <div id="attempts"></div>
</div>

<!-- STUDENT PANEL -->
<div id="studentPanel" class="box hidden">
  <h3>Student Panel</h3>
  <input id="studentName" placeholder="Student Name">
  <select id="studentClass">
    <option value="">Select Class</option>
    <option>Jr KG</option><option>Sr KG</option>
    <option>1</option><option>2</option><option>3</option>
    <option>4</option><option>5</option><option>6</option>
    <option>7</option><option>8</option><option>9</option><option>10</option>
  </select>
  <button onclick="loadTests()">Load Tests</button>
  <div id="studentTests"></div>
</div>

<!-- TEST AREA -->
<div id="testArea" class="box hidden">
  <h3 id="testTitle"></h3>
  <div class="timer" id="timer"></div>
  <div id="questionsArea"></div>
  <button onclick="submitTest()">Submit Test</button>
</div>

<script>
let tests = JSON.parse(localStorage.getItem("tests")||"[]");
let attempts = JSON.parse(localStorage.getItem("attempts")||"[]");
let currentTest, selectedAnswers={}, timeLeft, timerInt;

function showTeacher(){
  hideAll(); document.getElementById("teacherLogin").classList.remove("hidden");
}
function showStudent(){
  hideAll(); document.getElementById("studentPanel").classList.remove("hidden");
}
function hideAll(){
  document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden"));
}

function loginTeacher(){
  if(document.getElementById("teacherPin").value==="1914"){
    document.getElementById("teacherLogin").classList.add("hidden");
    document.getElementById("teacherPanel").classList.remove("hidden");
    renderTests(); renderAttempts();
  } else alert("Wrong PIN");
}

function createTest(){
  let q = document.getElementById("questions").value.trim().split("\n");
  let questions=[];
  for(let i=0;i<q.length;i+=6){
    questions.push({
      q:q[i], opts:q.slice(i+1,i+5), ans:+q[i+5]
    });
  }
  tests.push({
    id:Date.now(),
    name:testName.value,
    class:testClass.value,
    time:+testTime.value,
    questions
  });
  localStorage.setItem("tests",JSON.stringify(tests));
  alert("Test Created");
  renderTests();
}

function renderTests(){
  testList.innerHTML="";
  tests.forEach(t=>{
    testList.innerHTML+=`<div>${t.name} (${t.class})
    <button onclick="delTest(${t.id})">Delete</button></div>`;
  });
}

function delTest(id){
  tests=tests.filter(t=>t.id!==id);
  localStorage.setItem("tests",JSON.stringify(tests));
  renderTests();
}

function loadTests(){
  let cls=studentClass.value;
  studentTests.innerHTML="";
  tests.filter(t=>t.class===cls).forEach(t=>{
    studentTests.innerHTML+=
    `<button onclick="startTest(${t.id})">${t.name}</button>`;
  });
}

function startTest(id){
  currentTest=tests.find(t=>t.id===id);
  hideAll(); testArea.classList.remove("hidden");
  testTitle.innerText=currentTest.name;
  let qs=[...currentTest.questions].sort(()=>0.5-Math.random()).slice(0,30);
  questionsArea.innerHTML="";
  qs.forEach((q,i)=>{
    questionsArea.innerHTML+=
    `<div class="testBox"><b>${i+1}. ${q.q}</b>`+
    q.opts.map((o,oi)=>
      `<div class="option">
      <input type="radio" name="q${i}" onclick="selectedAnswers[${i}]=${oi}"> ${o}
      </div>`).join("")+
    `</div>`;
  });
  currentTest.randomQs=qs;
  startTimer(currentTest.time*60);
}

function startTimer(sec){
  timeLeft=sec;
  timerInt=setInterval(()=>{
    timer.innerText="Time Left: "+timeLeft+"s";
    if(--timeLeft<0){ clearInterval(timerInt); submitTest(); }
  },1000);
}

function submitTest(){
  clearInterval(timerInt);
  let score=0;
  currentTest.randomQs.forEach((q,i)=>{
    if(selectedAnswers[i]===q.ans) score++;
  });
  attempts.push({
    name:studentName.value,
    class:studentClass.value,
    test:currentTest.name,
    score
  });
  localStorage.setItem("attempts",JSON.stringify(attempts));
  alert("Test Submitted");
  location.reload();
}

function renderAttempts(){
  attempts.innerHTML="";
  attempts.forEach(a=>{
    document.getElementById("attempts").innerHTML+=
    `<div>${a.name} | ${a.class} | ${a.test} | ${a.score}</div>`;
  });
}
</script>
</body>
</html>
