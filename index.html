<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Online Exam System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{font-family:Arial;background:#eef2f5;margin:0}
.box{max-width:1000px;margin:20px auto;background:#fff;padding:20px;border-radius:8px}
button{padding:10px 15px;margin:5px;font-size:16px}
input,textarea,select{width:100%;padding:10px;margin:5px 0}
.hidden{display:none}
.question{border:1px solid #ccc;padding:10px;margin:10px 0;border-radius:5px}
.correct{color:green;font-weight:bold}
.wrong{color:red;font-weight:bold}
#timer{font-size:18px;color:red;text-align:right}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:8px;text-align:center}
</style>
</head>

<body>

<div class="box" id="menu">
<h2>Login As</h2>
<button onclick="showStudent()">Student</button>
<button onclick="showTeacher()">Teacher</button>
<button onclick="showAdmin()">Admin</button>
</div>

<!-- STUDENT LOGIN -->
<div class="box hidden" id="studentLogin">
<h2>Student Login</h2>
<input id="sname" placeholder="Student Name">
<input id="sroll" placeholder="Roll Number">
<button onclick="studentLogin()">Enter</button>
<button onclick="back()">Back</button>
</div>

<!-- TEACHER LOGIN -->
<div class="box hidden" id="teacherLogin">
<h2>Teacher Login</h2>
<input id="tpin" type="password" placeholder="Teacher PIN">
<button onclick="teacherEnter()">Enter</button>
<button onclick="back()">Back</button>
</div>

<!-- ADMIN LOGIN -->
<div class="box hidden" id="adminLogin">
<h2>Admin Login</h2>
<input id="apin" type="password" placeholder="Admin PIN">
<button onclick="adminEnter()">Enter</button>
<button onclick="back()">Back</button>
</div>

<!-- TEACHER PANEL -->
<div class="box hidden" id="teacherPanel">
<h2>Create Test</h2>
<input id="testName" placeholder="Test Name">
<input id="testTime" type="number" placeholder="Time (minutes)">
<textarea id="testQuestions" rows="12"
placeholder="Question |
Option1 |
Option2 |
Option3 |
Option4 |
CorrectIndex (0-3)"></textarea>
<button onclick="saveTest()">Save Test</button>

<h3>Student Attempts</h3>
<table>
<thead><tr><th>Name</th><th>Roll</th><th>Test</th><th>Score</th></tr></thead>
<tbody id="attemptTable"></tbody>
</table>

<button onclick="back()">Logout</button>
</div>

<!-- STUDENT DASH -->
<div class="box hidden" id="studentDash">
<h2>Select Test</h2>
<select id="testList"></select>
<button onclick="startTest()">Start Test</button>
</div>

<!-- EXAM -->
<div class="box hidden" id="examBox">
<div id="timer"></div>
<h2>Exam</h2>
<div id="exam"></div>
<button onclick="submitTest()">Submit</button>
</div>

<!-- RESULT -->
<div class="box hidden" id="resultBox">
<h2>Result</h2>
<div id="result"></div>
<button onclick="location.reload()">Finish</button>
</div>

<script>
// ðŸ”¥ FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "PASTE_HERE",
  authDomain: "PASTE_HERE",
  databaseURL: "PASTE_HERE",
  projectId: "PASTE_HERE"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸ” PINS
const TEACHER_PIN="1234";
const ADMIN_PIN="9999";

let student={}, allQuestions=[], examQuestions=[];
let examTimer, timeLeft, currentTest="";

// UI
function hideAll(){document.querySelectorAll('.box').forEach(b=>b.classList.add('hidden'))}
function back(){location.reload()}
function showStudent(){hideAll();studentLogin.classList.remove('hidden')}
function showTeacher(){hideAll();teacherLogin.classList.remove('hidden')}
function showAdmin(){hideAll();adminLogin.classList.remove('hidden')}

// STUDENT
function studentLogin(){
if(!sname.value||!sroll.value){alert("Enter details");return;}
student={name:sname.value,roll:sroll.value};
hideAll();studentDash.classList.remove('hidden');loadTests();
}

// TEACHER
function teacherEnter(){
if(tpin.value===TEACHER_PIN){
hideAll();teacherPanel.classList.remove('hidden');
loadAttempts();
}else alert("Wrong PIN");
}

// ADMIN
function adminEnter(){
if(apin.value===ADMIN_PIN) alert("Admin logged");
else alert("Wrong PIN");
}

// SAVE TEST
function saveTest(){
let lines=testQuestions.value.trim().split('\n');
let q=[];
for(let i=0;i<lines.length;i+=6){
q.push({q:lines[i],o:[lines[i+1],lines[i+2],lines[i+3],lines[i+4]],a:parseInt(lines[i+5])});
}
db.ref("tests/"+testName.value).set({time:testTime.value,questions:q});
alert("Test saved");
}

// LOAD TESTS
function loadTests(){
db.ref("tests").once("value",snap=>{
testList.innerHTML="";
snap.forEach(s=>{
let o=document.createElement("option");
o.value=s.key;o.text=s.key;
testList.appendChild(o);
});
});
}

// START TEST
function startTest(){
db.ref("tests/"+testList.value).once("value",snap=>{
let data=snap.val();
currentTest=testList.value;
allQuestions=data.questions;
timeLeft=data.time*60;
examQuestions=shuffle(allQuestions).slice(0,30);
showExam();
startTimer();
});
}

// TIMER
function startTimer(){
timer.innerText="Time: "+format(timeLeft);
examTimer=setInterval(()=>{
timeLeft--;
timer.innerText="Time: "+format(timeLeft);
if(timeLeft<=0){clearInterval(examTimer);submitTest();}
},1000);
}
function format(s){let m=Math.floor(s/60);let ss=s%60;return m+":"+("0"+ss).slice(-2);}

// EXAM
function showExam(){
hideAll();examBox.classList.remove('hidden');
exam.innerHTML="";
examQuestions.forEach((q,i)=>{
let d=document.createElement("div");
d.className="question";
d.innerHTML=`<b>${i+1}. ${q.q}</b>`;
q.o.forEach((op,ix)=>{
d.innerHTML+=`<label><input type="radio" name="q${i}" value="${ix}"> ${op}</label><br>`;
});
exam.appendChild(d);
});
}

// SUBMIT
function submitTest(){
clearInterval(examTimer);
let score=0,html="";
examQuestions.forEach((q,i)=>{
let sel=document.querySelector(`input[name=q${i}]:checked`);
let ans=sel?parseInt(sel.value):-1;
if(ans===q.a) score++;
html+=`<p>${i+1}. ${q.q}<br>
<span class="${ans===q.a?'correct':'wrong'}">
Your: ${ans>=0?q.o[ans]:"NA"} | Correct: ${q.o[q.a]}
</span></p>`;
});
db.ref("attempts/"+Date.now()).set({student,test:currentTest,score});
hideAll();resultBox.classList.remove('hidden');
result.innerHTML=`<h3>Score: ${score}/30</h3>`+html;
}

// LOAD ATTEMPTS
function loadAttempts(){
db.ref("attempts").on("value",snap=>{
attemptTable.innerHTML="";
snap.forEach(s=>{
let a=s.val();
attemptTable.innerHTML+=`<tr><td>${a.student.name}</td><td>${a.student.roll}</td><td>${a.test}</td><td>${a.score}</td></tr>`;
});
});
}

// SHUFFLE
function shuffle(a){return a.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);}
</script>

</body>
</html>
